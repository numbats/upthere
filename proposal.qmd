---
title: "Do the VFL and VFLW stats suggest performance in AFL and AFLW?"
author: "Minh Hyunh, Ignacio Alvarez, Dianne Cook"
branding: true
linestretch: 1.2
format: memo-typst
---

## Topic

A common question in Australian rules football is how well state-level (VFLM, VLFW) performance translates into success at the elite level (AFLM, AFLW).

- Raw comparisons between VFL(M/W) and AFL(M/W) players are biased: only a subset of VFL(M/W) athletes are drafted, and they may already differ in age, position, or performance profile.
- Propensity score matching (PSM) provides a way to create comparable groups of players, balancing observed characteristics before comparing outcomes.
- With the [fitzRoy R package](https://jimmyday12.github.io/fitzRoy/), researchers can access both AFL(M/W) and VFL(M/W) match and player statistics from AFL(M/W) Tables, making it possible to conduct a rigorous causal-style analysis of talent pathways.

## Plan

1.	Use the [fitzRoy](https://jimmyday12.github.io/fitzRoy/) package to collect historical AFL(M/W) and VFL(M/W) player-level data.
2.  Organise the data to contain statistics for players in VFL(M/W) and AFL(M/W).
3.  Explore the statistics and demographics of players that didn't transition from VFL(M/W) to AFL(M/W). 
4. Subset to players who made the transition. 
5.	Conduct clustering of VFL(M/W) players into groups based on demographics, age, height, position.
6.	Use PSM to match VFL(M/W) players who transition to AFL(M/W) with similar VFL(M/W) players who do not.
7.	Estimate the "treatment effect" of AFL(M/W) selection on subsequent performance outcomes, and test whether VFL(M/W) performance indicators predict AFL(M/W) success.

```{r}
#| echo: false
#| eval: false
library(fitzRoy)
w1 <- fetch_player_stats(2021, comp = "VFLW", source = "AFL")
m1 <- fetch_player_stats(2021, comp = "VFL", source = "AFL")
w2 <- fetch_player_stats(2024, comp = "AFLW", source = "AFL")
m2 <- fetch_player_stats(2024, comp = "AFLM", source = "AFL")
save(w1, file="data/w1.rda")
save(m1, file="data/m1.rda")
save(w2, file="data/w2.rda")
save(m2, file="data/m2.rda")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 8
#| fig-height: 4
#| out-width: 100%
library(tidyverse)
library(patchwork)
load("data/w1.rda")
load("data/m1.rda")
load("data/w2.rda")
load("data/m2.rda")

w1_smry <- w1 |>
  group_by(player.player.player.playerId) |>
  summarise_if(is.numeric, mean)
w1_names <- w1 |>
  select(player.player.player.playerId,
         player.player.player.givenName,
         player.player.player.surname) |>
  distinct()
w1_smry <- left_join(w1_smry, w1_names) |>
  rename(id = player.player.player.playerId,
         given_name = player.player.player.givenName,
         surname = player.player.player.surname) |>
  select(id, given_name, surname,
         goals:freesAgainst)

w2_smry <- w2 |>
  group_by(player.player.player.playerId) |>
  summarise_if(is.numeric, mean)
w2_names <- w2 |>
  select(player.player.player.playerId,
         player.player.player.givenName,
         player.player.player.surname) |>
  distinct()
w2_smry <- left_join(w2_smry, w2_names) |>
  rename(id = player.player.player.playerId,
         given_name = player.player.player.givenName,
         surname = player.player.player.surname) |>
  select(id, given_name, surname,
         goals:freesAgainst)

w <- left_join(w1_smry, w2_smry, 
               by=c("given_name", "surname")) |>
  rename(goalsVFLW = goals.x,
         goalsAFLW = goals.y,
         marksVFLW = marks.x,
         marksAFLW = marks.y) 

wp <- ggplot(w, aes(x=goalsVFLW, y=goalsAFLW)) +
  geom_point() +
  geom_text(data=filter(w, goalsAFLW > 1.3), 
            aes(x=goalsVFLW, y=goalsAFLW,
                label=paste(given_name, surname)),
            colour="red") +
  theme(aspect.ratio = 1)

m1_smry <- m1 |>
  group_by(player.player.player.playerId) |>
  summarise_if(is.numeric, mean)
m1_names <- m1 |>
  select(player.player.player.playerId,
         player.player.player.givenName,
         player.player.player.surname) |>
  distinct()
m1_smry <- left_join(m1_smry, m1_names) |>
  rename(id = player.player.player.playerId,
         given_name = player.player.player.givenName,
         surname = player.player.player.surname) |>
  select(id, given_name, surname,
         goals:freesAgainst)

m2_smry <- m2 |>
  group_by(player.player.player.playerId) |>
  summarise_if(is.numeric, mean)
m2_names <- m2 |>
  select(player.player.player.playerId,
         player.player.player.givenName,
         player.player.player.surname) |>
  distinct()
m2_smry <- left_join(m2_smry, m2_names) |>
  rename(id = player.player.player.playerId,
         given_name = player.player.player.givenName,
         surname = player.player.player.surname) |>
  select(id, given_name, surname,
         goals:freesAgainst)

m <- left_join(m1_smry, m2_smry, 
               by=c("given_name", "surname")) |>
  rename(goalsVFLM = goals.x,
         goalsAFLM = goals.y,
         marksVFLM = marks.x,
         marksAFLM = marks.y) 

mp <- ggplot(m, aes(x=goalsVFLM, y=goalsAFLM)) +
  geom_point() +
  geom_text(data=filter(m, goalsAFLM > 2), 
            aes(x=goalsVFLM, y=goalsAFLM,
                label=paste(given_name, surname)),
            colour="red") +
  theme(aspect.ratio = 1)

wp + mp + plot_layout(ncol=2)
```
